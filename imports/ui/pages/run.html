<template name="sessionSetup">
    {{#with template templateId}}
        {{> sessionTemplate inputs=inputs page=page session=session stages=stages template=templateId}}

        {{#if success}}
            {{> sessionSuccess}}
        {{/if}}
    {{/with}}
</template>

<template name="sessionSuccess">
    <div id="success" class="ui icon success message transition hidden in">
        <i class="exclamation icon"></i>
        <i class="close icon"></i>
        <div class="header">
            Session successfully created.
        </div>
    </div>
</template>

<template name="sessionTemplate">
    <form id="device-form" class="ui equal width inverted form">
        <div class="ui basic segment">
            <a id="save" class="ui {{#if hasTemplate}}grey{{else}}blue{{/if}} corner label">
                <i class="save icon"></i>
            </a>

            <div class="fields">
                <div class="field">
                    <label>Current Template</label>
                    {{> templateDropdown}}
                </div>

                <div class="field">
                    <label>Device(s)</label>
                    {{> deviceDropdown}}
                </div>
            </div>
        </div>
    </form>

    <div id="session-accordion" class="ui fluid inverted accordion">
        <div class="title">
            <i class="dropdown icon"></i>
            <span class="ui inverted header">Session Settings</span>
        </div>
        <div class="content">
            {{#with session}}
                {{> sessionForm}}
            {{/with}}
        </div>

        <div id="stages" class="title">
            <i class="dropdown icon"></i>
            <span class="ui inverted header">Stages</span>
        </div>
        <div class="content">
            <div class="ui grey inverted top attached tabular menu">
                {{#each stages}}
                    {{> stageItem (index @index)}}
                {{/each}}

                <div class="right floated menu">
                    <a id="add-stage" class="ui animated button item">
                        <div class="visible content">
                            <i class="plus icon"></i>
                        </div>
                        <div class="hidden content">Add</div>
                    </a>
                </div>
            </div>

            <div class="ui bottom attached inverted segment">
                <div id="stages-accordion" class="accordion">
                    <div class="ui horizontal divider">
                        {{> elementDropdown}}
                    </div>
                    <section class="ui inverted segment">
                        {{#each stage page stages}}
                            {{> stagePage (section @index)}}
                        {{/each}}
                    </section>


                    <div class="ui horizontal divider">
                        {{> inputDropdown}}
                    </div>
                    <section class="ui inverted segment">
                        <div class="ui middle aligned divided list">
                            {{#each input page inputs}}
                                <div class="item">
                                    <div class="right floated content">
                                        <i class="grey link cancel icon"></i>
                                    </div>

                                    <div class="content">
                                        <span class="ui black inverted label">If </span>

                                        {{> eventDropdown}}

                                        {{#each conditions}}
                                            {{#each objects}}
                                                <a class="ui mini grey image label">
                                                    {{name}}
                                                    <span class="detail">{{property}}</span>
                                                </a>
                                            {{/each}}

                                            <a class="ui mini grey image label">{{comparison}}</a>

                                            {{#each subjects}}
                                                <a class="ui mini grey image label">
                                                    {{action}}
                                                    <span class="detail">{{property}}</span>
                                                </a>
                                            {{/each}}

                                            &
                                        {{/each}}

                                        {{> conditionsDropdown}}

                                        <span class="ui black inverted label">
                                            <i class="right arrow icon"></i>
                                        </span>

                                        {{> correctDropdown}}
<!--                                        {{#each correct}}-->
<!--                                            <a class="ui mini grey image label">-->
<!--                                                {{action}}-->
<!--                                                {{#if specifications.amount}}-->
<!--                                                    <span class="detail">{{specifications.amount}}</span>-->
<!--                                                {{/if}}-->
<!--                                            </a>-->

<!--                                            {{#each targets}}-->
<!--                                                <a class="ui mini grey label">-->
<!--                                                    {{#unless type}}{{this}}{{else}}{{type}}{{/unless}}-->
<!--                                                </a>-->
<!--                                            {{/each}}-->

<!--                                            <span class="ui black inverted label"> & </span>-->
<!--                                        {{/each}}-->

                                        {{> incorrectDropdown}}
<!--                                        {{#if incorrect}}-->
<!--                                            else-->
<!--                                            {{#each incorrect}}-->
<!--                                                <a class="ui mini grey label">{{action}}</a>-->

<!--                                                {{#each objects}}-->
<!--                                                    <a class="ui mini grey label">{{type}}</a>-->
<!--                                                {{/each}}-->
<!--                                            {{/each}}-->
<!--                                        {{/if}}-->
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <div class="ui hidden divider"></div>
        <button class="ui black fluid button" type="submit">Run</button>
    </div>
</template>

<template name="stageItem">
    <a class="stage {{#if active}}active{{/if}} item">
        {{index}}
    </a>
</template>

<template name="stagePage">
    {{#if $eq type 'audio'}}
        <div id="{{type}}-section" class="title">
            <i class="dropdown icon"></i>
            <i class="grey link music icon"></i>
            Audio
        </div>
        <div class="content">
            {{> audioForm}}
        </div>
    {{/if}}
    {{#if $eq type 'cross'}}
        <div id="{{type}}-section" class="title">
            <i class="dropdown icon"></i>
            <i class="grey link plus icon"></i>
            Cross
        </div>
        <div class="content">
            {{> crossForm}}
        </div>
    {{/if}}
    {{#if $eq type 'light'}}
        <div id="{{type}}-section" class="title">
            <i class="dropdown icon"></i>
            <i class="grey link lightbulb icon"></i>
            Light
        </div>
        <div class="content">
            {{> lightForm}}
        </div>
    {{/if}}
    {{#if $eq type 'reward'}}
        <div id="{{type}}-section" class="title">
            <i class="dropdown icon"></i>
            <i class="grey link star icon"></i>
            Reward
        </div>
        <div class="content">
            {{> rewardForm}}
        </div>
    {{/if}}
    {{#if $eq type 'stimuli'}}
        <div id="{{type}}-section" class="title">
            <i class="dropdown icon"></i>
            <i class="grey link bars icon"></i>
            Stimuli
        </div>
        <div class="content">
            {{> stimuliForm}}
        </div>
    {{/if}}
</template>
